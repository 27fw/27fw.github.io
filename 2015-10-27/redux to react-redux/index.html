<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Redux的工作流程教程 | firework's Studio</title><meta name="description" content="Redux的工作流程教程 - Wee"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="firework's Studio"></head><body><div class="wrap"><header><h1 class="branding"><a href="/" title="firework's Studio">firework's Studio</a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/index.html" target="_self">ARCHIVES</a></li><li class="nav-list-item"><a class="nav-list-link" href="/about" target="_self">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Redux的工作流程教程</h1><div class="post-info">2015/10/27</div><div class="post-content"><h3 id="redux的工作流程"><a href="#redux的工作流程" class="headerlink" title="redux的工作流程"></a>redux的工作流程</h3><ol>
<li><p>使用<code>createStore</code>创建一个管理数据的store。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> store = createStore(reducer)</div></pre></td></tr></table></figure>
<p>store的实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">const</span> createStore = <span class="function">(<span class="params">reducer</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">let</span> state;</div><div class="line">  <span class="keyword">let</span> listeners = [];</div><div class="line"></div><div class="line">  <span class="keyword">const</span> getState = <span class="function"><span class="params">()</span> =&gt;</span> state;</div><div class="line"></div><div class="line">  <span class="keyword">const</span> dispatch = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</div><div class="line">    state = reducer(state, action);</div><div class="line">    listeners.forEach(<span class="function"><span class="params">listener</span> =&gt;</span> listener());</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">const</span> subscribe = <span class="function">(<span class="params">listener</span>) =&gt;</span> &#123;</div><div class="line">    listeners.push(listener);</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      listeners = listeners.filter(<span class="function"><span class="params">l</span> =&gt;</span> l !== listener);</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="comment">// 在创建store的实例时先执行一次，将reducer的默认参数赋给state</span></div><div class="line">  dispatch(&#123;&#125;);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123; getState, dispatch, subscribe &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>store就具有以下功能了：</p>
<ul>
<li>store.subscribe() - 向store设置监听函数，一旦 State 发生变化，就自动执行这个函数。</li>
<li>store.getState() - 通过闭包访问的真实的state被隐藏在store中，通过<code>store.getState()</code>来获取State。</li>
<li>store.dispatch() - 接受<code>action</code>来改变State，并执行所有监听的函数。</li>
<li>store.unsubscribe() - 不再监听对应的函数。</li>
</ul>
</li>
<li><p>用户通过UI的触发store的<code>dispatch</code>函数，在这一步中会自动调用<code>createStore</code>中作为参数的<code>reducer</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">store.dispath(action)</div></pre></td></tr></table></figure>
</li>
<li><p>store会自动调用使用<code>createStore</code>函数时传入的reducer，将<code>action</code>作为参数传给reducer，reducer会返回新的State，并会顺便执行所有监听的函数。</p>
</li>
</ol>
<ol>
<li><p>部分时候在多个组件中存在多个reducer，但是store只有一个，所以需要将所有reducer合并起来变成一个reducer用来<code>createStore</code>给store控制。使用的是<code>combineReducers</code>这个方法。</p>
<p>实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> combineReducers = <span class="function"><span class="params">reducers</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">state = &#123;&#125;, action</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.keys(reducers).reduce(</div><div class="line">      (nextState, key) =&gt; &#123;</div><div class="line">        nextState[key] = reducers[key](state[key], action);</div><div class="line">        <span class="keyword">return</span> nextState;</div><div class="line">      &#125;,</div><div class="line">      &#123;&#125; </div><div class="line">    );</div><div class="line">  &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>传入一个<code>action</code>会依次执行各个被合并的reducer，最后将各个reducer的结果组合成一个对象输出，各个reducer的键名就是传入的<code>reducers</code>中对应的key。</p>
<p>最后再用一张阮老师博客中的流程图表示</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2016/bg2016091802.jpg" alt="redux-process"></p>
<p>​</p>
</li>
</ol>
<h3 id="从redux到react-redux"><a href="#从redux到react-redux" class="headerlink" title="从redux到react-redux"></a>从redux到react-redux</h3><p>在react中使用react-redux能够更方便的管理状态。</p>
<blockquote>
<p>React-Redux 规定，所有的 UI 组件都由用户提供，容器组件则是由 React-Redux 自动生成。也就是说，用户负责视觉层，状态管理则是全部交给它。</p>
</blockquote>
<p>相比redux，react-redux主要多了以下几个方法：</p>
<ul>
<li><code>connect()</code> - 负责将用户写的UI组件和react-redux自动生成的容器组件连接起来。</li>
<li><code>mapStateToProps()</code> - 将作为react-redux自动生成的容器组件的属性传递给用户创建的UI组件，如果这些属性发生变化，会引起UI组件的重新渲染。如果不给<code>connect</code>传递<code>mapStateToProps</code>，那么Store的更新将不会引起UI组件的更新。</li>
<li><code>mapDispatchToProps()</code> - 用来建立UI组件的参数到<code>store.dispatch</code>方法的映射。</li>
<li><code>&lt;Provider&gt;</code>组件</li>
</ul>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2015-11-08/HOC/">prev</a><a class="next" href="/2013-02-05/使用githubHexo搭建个人博客/">next</a></div><div id="lv-container" data-id="city" data-uid="MTAyMC8yODQyOS81MDAw"><script type="text/javascript">(function(d, s) {
var j, e = d.getElementsByTagName(s)[0];

if (typeof LivereTower === 'function') { return; }

j = d.createElement(s);
j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
j.async = true;

e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div><noscript>为正常使用来必力评论功能请激活JavaScript</noscript><div class="copyright"><p>&copy; 2017 <a href="https://fi3ework.github.io">Wee</a>.<br>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> × <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Ares</a>.</p></div></footer></div><script src="/scripts/tag.js"></script></body></html>